!function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var m=new Error("Cannot find module '"+a+"'");throw m.code="MODULE_NOT_FOUND",m}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return o(n?n:t)},u,u.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){"use strict";function i(t){var e=this;if(t.element)o(t.element,e);else{if(!t.commonData)throw new Error(a.missingParameter);r(t.commonData,e)}}function o(t,e){var n,i,o,r;for(e.commonData={ID:t.getAttribute(u),displayText:t.getAttribute(p),associatedXooMLFragment:t.getAttribute(l),associatedXooMLDriver:t.getAttribute(f),associatedSyncDriver:t.getAttribute(g),associatedItemDriver:t.getAttribute(d),associatedItem:t.getAttribute(v),localItem:t.getAttribute(h),isGrouping:JSON.parse(t.getAttribute(y)),publicURL:t.getAttribute(D)},e.namespace={},n=t.getElementsByTagName(m),i=0;i<n.length;i+=1){for(r=n[i],o=r.namespaceURI,e.namespace[o]={},e.namespace[o].attributes={},i=0;i<r.attributes.length;i+=1)"xmlns"!==r.attributes[i].name&&(e.namespace[o].attributes[r.attributes[i].localName]=r.getAttributeNS(o,r.attributes[i].localName));e.namespace[o].data=r.textContent}}function r(t,e){if(!t)throw a.nullArgument;e.commonData={displayText:t.displayText||null,associatedXooMLFragment:t.associatedXooMLFragment||null,associatedXooMLDriver:t.associatedXooMLDriver||null,associatedSyncDriver:t.associatedSyncDriver||null,associatedItemDriver:t.associatedItemDriver||null,associatedItem:t.associatedItem||null,localItem:t.localItem||null,isGrouping:t.isGrouping||!1,ID:s.generateGUID(),publicURL:t.publicURL||null},e.namespace={}}var a=t("./XooMLExceptions"),s=t("./XooMLUtil"),c="association",m="associationNamespaceElement",u="ID",p="displayText",l="associatedXooMLFragment",f="associatedXooMLDriver",g="associatedSyncDriver",d="associatedItemDriver",v="associatedItem",h="localItem",y="isGrouping",D="publicURL";i.prototype.toElement=function(){var t=this,e=document.createElementNS(null,c);return Object.keys(t.commonData).forEach(function(n){t.commonData[n]&&e.setAttribute(n,t.commonData[n])}),Object.keys(t.namespace).forEach(function(n){var i=document.createElementNS(n,m);Object.keys(t.namespace[n].attributes).forEach(function(e){i.setAttributeNS(n,e,t.namespace[n].attributes[e])}),i.textContent=t.namespace[n].data,e.appendChild(i)}),e},e.exports=i},{"./XooMLExceptions":6,"./XooMLUtil":7}],2:[function(t,e,n){"use strict";function i(t){var e=this;if(t.text)r(t.text,e);else if(t.element)a(t.element,e);else{if(!t.commonData)throw new Error(s.missingParameter);o(t.commonData,t.associations,e)}}function o(t,e,n){if(!t)throw s.nullArgument;n.commonData={displayName:t.displayName||null,schemaLocation:t.schemaLocation||null,schemaVersion:t.schemaVersion||null,itemDriver:t.itemDriver||null,itemDescribed:t.itemDescribed||null,syncDriver:t.syncDriver||null,xooMLDriver:t.xooMLDriver||null,GUIDGeneratedOnLastWrite:c.generateGUID()},n.associations={},e.forEach(function(t){var e=t.commonData.ID;n.associations[e]=t}),n.namespace={}}function r(t,e,n){var i=new DOMParser,o=i.parseFromString(t,"application/xml");a(o.children[0],e,n)}function a(t,e){var n,i,o,r,a,s;for(e.commonData={fragmentNamespaceElement:t.getAttribute(f),schemaVersion:t.getAttribute(g),schemaLocation:t.getAttribute(d),itemDescribed:t.getAttribute(v),displayName:t.getAttribute(h),itemDriver:t.getAttribute(y),syncDriver:t.getAttribute(D),xooMLDriver:t.getAttribute(I),GUIDGeneratedOnLastWrite:t.getAttribute(x)},e.namespace={},n=t.getElementsByTagName(f),i=0;i<n.length;i+=1){for(a=n[i],s=a.namespaceURI,e.namespace[s]={},e.namespace[s].attributes={},i=0;i<a.attributes.length;i+=1)"xmlns"!==a.attributes[i].name&&(e.namespace[s].attributes[a.attributes[i].localName]=a.getAttributeNS(s,a.attributes[i].localName));e.namespace[s].data=a.textContent}for(e.associations={},o=t.getElementsByTagName(p),i=0;i<o.length;i+=1)r=o[i].getAttribute(l),e.associations[r]=new m({element:o[i]})}var s=t("./XooMLExceptions"),c=t("./XooMLUtil"),m=t("./AssociationEditor"),u="fragment",p="association",l="ID",f="fragmentNamespaceElement",g="schemaVersion",d="schemaLocation",v="itemDescribed",h="displayName",y="itemDriver",D="syncDriver",I="xooMLDriver",x="GUIDGeneratedOnLastWrite",_="http://kftf.ischool.washington.edu/xmlns/xooml";i.prototype.updateID=function(){var t=c.generateGUID();return this.commonData.GUIDGeneratedOnLastWrite=t,t},i.prototype.toElement=function(){var t=this,e=document.createElementNS(_,u);return Object.keys(t.commonData).forEach(function(n){var i=t.commonData[n];i&&e.setAttribute(n,i)}),Object.keys(t.namespace).forEach(function(n){var i=document.createElementNS(n,f);Object.keys(t.namespace[n].attributes).forEach(function(e){i.setAttributeNS(n,e,t.namespace[n].attributes[e])}),i.textContent=t.namespace[n].data,e.appendChild(i)}),Object.keys(t.associations).forEach(function(n){e.appendChild(t.associations[n].toElement())}),e},i.prototype.toString=function(){var t=new XMLSerializer;return t.serializeToString(this.toElement())},e.exports=i},{"./AssociationEditor":1,"./XooMLExceptions":6,"./XooMLUtil":7}],3:[function(t,e,n){"use strict";function i(t,e){function n(){var t=['<fragment xmlns="http://kftf.ischool.washington.edu/xmlns/xooml" itemDescribed="/" displayName="Dropbox" itemDriver="dropboxItemDriver" syncDriver="itemMirrorSyncUtility" xooMLDriver="dropboxXooMLDriver" GUIDGeneratedOnLastWrite="771c1026-b8d8-4457-9594-01531b9f7ca0">','<association ID="a02f53d2-18af-4faf-ace9-5305cb808ec5" displayText="Dropbox" associatedItem="Dropbox" isGrouping="true">',"</association>",'<association ID="27955628-7850-4c71-be12-6caed1c9463c" displayText="Google Drive" associatedItem="gapi" isGrouping="true">',"</association>","</fragment>"].join("\n");return h._fragment=new m({text:t}),e(!1,h)}function i(){h._xooMLDriverClient=t.xooMLDriver.clientInterface,h._itemDriverClient=t.xooMLDriver.clientInterface,h._xooMLDriver=null,h._itemDriver=null,h._syncDriver=null,h._creator=t.creator||null,h._groupingItemURI=t.groupingItemURI,h._newItemMirrorOptions=t,v="TBD",h.fragmentURI=t.fragmentURI||null,t.xooMLDriver.fragmentURI=d,new a(t.xooMLDriver,u)}function u(t,n){return t?e(t):(h._xooMLDriver=n,void h._xooMLDriver.getXooMLFragment(p))}function p(n,i){if("XooML Not Found"===n)new s(t.itemDriver,f);else{if(n)return e(n);l(i)}}function l(n){h._fragment=new m({text:n}),new s(t.itemDriver,function(t,n){return t?e(t):(h._itemDriver=n,h._syncDriver=new c(h),void h.refresh(function(){return e(!1,h)}))})}function f(t,e){h._itemDriver=e,h._itemDriver.listItems(h._groupingItemURI,g)}function g(t,n){return t?e(t):(h._fragment=new m({commonData:{itemDescribed:h._groupingItemURI,displayName:v,itemDriver:"dropboxItemDriver",xooMLDriver:"dropboxXooMLDriver",syncDriver:"itemMirrorSyncUtility"},associations:n}),h._syncDriver=new c(h),h._xooMLDriver.setXooMLFragment(h._fragment.toString(),function(t){if(t)throw new Error(t)}),e(!1,h))}if(r.checkCallback(e),!t)return e(o.nullArgument);var d,v,h=this;"string"==typeof t?n():i()}var o=t("./XooMLExceptions"),r=t("./XooMLUtil"),a=t("./google-xooml-driver"),s=t("./google-item-driver"),c=t("./SyncDriver"),m=t("./FragmentEditor"),u=t("./AssociationEditor");i.prototype.getDisplayName=function(){return this._fragment.commonData.displayName},i.prototype.setDisplayName=function(t){this._fragment.commonData.displayName=t},i.prototype.getSchemaVersion=function(){return this._fragment.commonData.schemaVersion},i.prototype.getSchemaLocation=function(){return this._fragment.commonData.schemaLocation},i.prototype.getURIforItemDescribed=function(){return this._fragment.commonData.itemDescribed},i.prototype.getPublicURL=function(t){return this._fragment.associations[t].commonData.publicURL},i.prototype.getAssociationDisplayText=function(t){return this._fragment.associations[t].commonData.displayText},i.prototype.setAssociationDisplayText=function(t,e){this._fragment.associations[t].commonData.displayText=e},i.prototype.getAssociationLocalItem=function(t){return this._fragment.associations[t].commonData.localItem},i.prototype.getAssociationAssociatedItem=function(t){return this._fragment.associations[t].commonData.associatedItem},i.prototype.getFragmentNamespaceAttribute=function(t,e){var n=this._fragment.namespace;return n[e]=n[e]||{},n[e].attributes=n[e].attributes||{},this._fragment.namespace[e].attributes[t]},i.prototype.setFragmentNamespaceAttribute=function(t,e,n){var i=this._fragment.namespace;i[n]=i[n]||{},i[n].attributes=i[n].attributes||{},this._fragment.namespace[n].attributes[t]=e},i.prototype.addFragmentNamespaceAttribute=function(t,e){var n=this._fragment.namespace;if(n[e]=n[e]||{},n[e].attributes=n[e].attributes||{},this._fragment.namespace[e].attributes[t])throw o.invalidState;this.setFragmentNamespaceAttribute(t,e)},i.prototype.removeFragmentNamespaceAttribute=function(t,e){delete this._fragment.namespace[e].attributes[t]},i.prototype.hasFragmentNamespace=function(t){var e=this._fragment.namespace[t];return e?!0:!1},i.prototype.listFragmentNamespaceAttributes=function(t){return Object.keys(this._fragment.namespace[t].attributes)},i.prototype.getFragmentNamespaceData=function(t){return this._fragment.namespace[t].data},i.prototype.setFragmentNamespaceData=function(t,e){var n=this._fragment.namespace;n[e]=n[e]||{},this._fragment.namespace[e].data=t},i.prototype.createItemMirrorForAssociatedGroupingItem=function(t,e){var n,o,r,a,s,c=this,m=c.getAssociationAssociatedItem(t);if("Dropbox"===m){var u={fragmentURI:"/XooML2.xml",driverURI:"DropboxXooMLUtility",dropboxClient:dropboxClient},p={driverURI:"DropboxItemUtility",dropboxClient:dropboxClient},l={utilityURI:"MirrorSyncUtility"},f={groupingItemURI:"/",xooMLDriver:u,itemDriver:p,syncDriver:l};return new DropboxItemMirror(f,e)}if("gapi"===m){var g={clientInterface:gapi},d={clientInterface:gapi};return l={utilityURI:"MirrorSyncUtility"},f={groupingItemURI:"root",xooMLDriver:g,itemDriver:d,syncDriver:l},new i(f,e)}return r={driverURI:"GoogleItemUtility",clientInterface:this._itemDriverClient,associatedItem:c.getAssociationAssociatedItem(t)},o={fragmentURI:s,driverURI:"GoogleXooMLUtility",clientInterface:this._xooMLDriverClient,associatedItem:c.getAssociationAssociatedItem(t)},a={utilityURI:"SyncUtility"},(n=c.isAssociationAssociatedItemGrouping(t))?void new i({groupingItemURI:c.getAssociationAssociatedItem(t),xooMLDriver:o,itemDriver:r,syncDriver:a,creator:c},function(t,n){return e(t,n)}):e("Association not grouping, cannot continue")},i.prototype.createAssociation=function(t,e){var n,i,a=this;if(i=function(t){var n=t.commonData.ID;a._fragment.associations[n]=t,a.save(function(t){return e(t,n)})},!r.isFunction(e))throw o.invalidType;return r.isObject(t)?t.displayText&&t.localItem&&t.isGroupingItem?(n=new u({commonData:{displayText:t.displayText,isGrouping:!0,localItem:t.localItem,associatedItem:t.associatedItem}}),void a._itemDriver.createGroupingItem(t.displayText,function(t){return t?e(t):i(n)})):(t.displayText&&t.itemURI?n=new u({commonData:{displayText:t.displayText,associatedItem:t.itemURI,isGrouping:!1}}):t.displayText&&(n=new u({commonData:{displayText:t.displayText,isGrouping:!1}})),i(n)):e(o.invalidType)},i.prototype.isAssociationPhantom=function(t){var e=this._fragment.associations[t].commonData;return!(e.isGrouping||e.localItem)},i.prototype.copyAssociation=function(){throw new Error("Method not implemented")},i.prototype.moveAssociation=function(){throw new Error("Method not implemented")},i.prototype.deleteAssociation=function(t,e){function n(n){if(n)return e(n);var o=a.isAssociationPhantom(t);if(o)return delete a._fragment.associations[t],a._unsafeWrite(function(t){return t?e(t):e()});var r=a.isAssociationAssociatedItemGrouping(t),s=a.getAssociationAssociatedItem(t);return delete a._fragment.associations[t],r?a._itemDriver.deleteGroupingItem(s,i):a._itemDriver.deleteNonGroupingItem(s,i)}function i(t){return t?e(t):a.refresh(function(t){return e(t?t:t)})}var a=this;return r.checkCallback(e),t?r.isGUID(t)?a.save(n):e(o.invalidType):e(o.nullArgument)},i.prototype.upgradeAssociation=function(){throw new Error("Method not implemented")},i.prototype.renameAssociationLocalItem=function(t,e,n){function i(t){return t?n(t):void m._itemDriver.rename(e,a)}function a(i){return i?n(i):(m._fragment.associations[t].commonData.localItem=e,void m._unsafeWrite(s))}function s(t){return t?n(t):void m.refresh(c)}function c(e){return n(e,m._fragment.associations[t].commonData.ID)}var m=this;return r.checkCallback(n),t?r.isGUID(t)?void m.save(i):n(o.invalidType):n(o.nullArgument)},i.prototype._unsafeWrite=function(t){var e=this;return e._fragment.updateID(),e._xooMLDriver.setXooMLFragment(e._fragment.toString(),function(e){return t(e?e:!1)})},i.prototype.isAssociationAssociatedItemGrouping=function(t){return this._fragment.associations[t].commonData.isGrouping},i.prototype.listAssociations=function(){return Object.keys(this._fragment.associations)},i.prototype.getAssociationNamespaceAttribute=function(t,e,n){var i=this._fragment.associations[e].namespace;return i[n]=i[n]||{},i[n].attributes=i[n].attributes||{},this._fragment.associations[e].namespace[n].attributes[t]},i.prototype.setAssociationNamespaceAttribute=function(t,e,n,i){var o=this._fragment.associations[n].namespace;o[i]=o[i]||{},o[i].attributes=o[i].attributes||{},this._fragment.associations[n].namespace[i].attributes[t]=e},i.prototype.addAssociationNamespaceAttribute=function(t,e,n,i){var r=this._fragment.associations[n].namespace;if(r[i]=r[i]||{},r[i].attributes=r[i].attributes||{},this._fragment.associations[n].namespace[i].attributes[t])throw o.invalidState;this.setAssociationNamespaceAttribute(t,e,n,i)},i.prototype.removeAssociationNamespaceAttribute=function(t,e,n){delete this._fragment.associations[e].namespace[n].attributes[t]},i.prototype.hasAssociationNamespace=function(t,e){var n=this._fragment.associations[t].namespace[e];return n?!0:!1},i.prototype.listAssociationNamespaceAttributes=function(t,e){var n=this._fragment.associations[t].namespace;return n[e]=n[e]||{},n[e].attributes=n[e].attributes||{},Object.keys(this._fragment.associations[t].namespace[e].attributes)},self.getAssociationNamespaceData=function(t,e){var n=this._fragment.associations[t].namespace;return n[e]=n[e]||{},n[e].attributes=n[e].attributes||{},this._fragment.associations[t].namespace[e].data},i.prototype.setAssociationNamespaceData=function(t,e,n){var i=this._fragment.associations[e].namespace;i[n]=i[n]||{},i[n].attributes=i[n].attributes||{},this._fragment.associations[e].namespace[n].data=t},i.prototype._sync=function(t){var e=this;e._syncDriver.sync(t)},i.prototype.refresh=function(t){function e(e,i){return e?t(e):(n._fragment=new m({text:i}),t(!1))}var n=this;n._sync(function(i){i===o.itemMirrorNotCurrent?n._xooMLDriver.getXooMLFragment(e):i?t(i):n._xooMLDriver.getXooMLFragment(e)})},i.prototype.getCreator=function(){return this._creator},i.prototype.save=function(t){function e(e){return e?t(e):i._unsafeWrite(n)}function n(e){return t(e)}var i=this;i._sync(e)},self._isURL=function(t){return/^http:\/\//.exec(t)},e.exports=i,window&&(window.ItemMirror=window.ItemMirror||i)},{"./AssociationEditor":1,"./FragmentEditor":2,"./SyncDriver":4,"./XooMLExceptions":6,"./XooMLUtil":7,"./google-item-driver":8,"./google-xooml-driver":9}],4:[function(t,e,n){"use strict";function i(t){var e=this;e._itemMirror=t,e._itemDriver=t._itemDriver,e._xooMLDriver=t._xooMLDriver}function o(t,e){return t.commonData.localItem>e.commonData.localItem?1:t.commonData.localItem<e.commonData.localItem?-1:0}var r=t("./FragmentEditor");i.prototype.sync=function(t){function e(e,o){return e?t(e):(i=o,void a._xooMLDriver.getXooMLFragment(n))}function n(e,n){if(404===e){var s=a._itemMirror._fragment.toString();return a._xooMLDriver.setXooMLFragment(s,function(e){t(e?e:!1)})}if(e)return t(e);var c,m=0,u=!0;a._fragmentEditor=new r({text:n}),c=Object.keys(a._fragmentEditor.associations).map(function(t){return a._fragmentEditor.associations[t]}).filter(function(t){return null!==t.commonData.localItem}),i.sort(o),c.sort(o);var p=i.map(function(t){return t.commonData.localItem}),l=c.map(function(t){return t.commonData.localItem});return p.forEach(function(t,e){var n=l.lastIndexOf(t,m);if(-1===n){u=!1;var o=i[e];a._fragmentEditor.associations[o.commonData.ID]=o}else c.slice(m,n).forEach(function(t){u=!1,delete a._fragmentEditor.associations[t.guid]}),m=n+1}),c.slice(m,l.length).forEach(function(t){u=!1,delete a._fragmentEditor.associations[t.commonData.ID]}),u?t(!1):(a._fragmentEditor.updateID(),void a._xooMLDriver.setXooMLFragment(a._fragmentEditor.toString(),function(e){return t(e?e:!1)}))}var i,a=this;a._itemDriver.listItems(a._itemMirror._groupingItemURI,e)},e.exports=i},{"./FragmentEditor":2}],5:[function(t,e,n){e.exports={schemaVersion:"0.54",schemaLocation:"http://kftf.ischool.washington.edu/xmlns/xooml",xooMLFragmentFileName:"XooML2.xml",maxFileLength:50,createAssociationSimple:{displayText:!0},createAssociationLinkNonGrouping:{displayText:!0,itemURI:!0,localItemRequested:!1},createAssociationLinkGrouping:{displayText:!0,groupingItemURI:!0,xooMLDriverURI:!0},createAssociationCreate:{displayText:!0,itemName:!0,isGroupingItem:!0}}},{}],6:[function(t,e,n){e.exports={notImplemented:"NotImplementedException",missingParameter:"MissingParameterException",nullArgument:"NullArgumentException",invalidType:"InvalidTypeException",invalidState:"InvalidStateArgument",xooMLUException:"XooMLUException",itemUException:"ItemUException",nonUpgradeableAssociationException:"NonUpgradeableAssociationException",invalidArgument:"InvalidOptionsException",itemAlreadyExists:"ItemAlreadyExistsException",itemMirrorNotCurrent:"ItemMirrorNotCurrent"}},{}],7:[function(t,e,n){"use strict";var i=t("./XooMLExceptions"),o={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object","[object Error]":"error"},r={hasOptions:function(t,e){if(!t||!e)throw i.nullArgument;if(!r.isObject(t)||!r.isObject(e))throw i.invalidType;var n,o,a;if(a=0,!(Object.keys(e).length<=Object.keys(t).length))return!1;for(n in t)if(t.hasOwnProperty(n)&&(o=t[n],!e.hasOwnProperty(n))){if(o)return!1;a+=1}return Object.keys(e).length<=Object.keys(t).length-a},checkCallback:function(t){if(!t)throw i.nullArgument;if(!r.isFunction(t))throw i.invalidType},isGUID:function(t){return"string"===r.getType(t)?!0:!1},isArray:function(t){return"array"===r.getType(t)},isObject:function(t){return"object"===r.getType(t)},isFunction:function(t){return null!==t},isString:function(t){return"string"===r.getType(t)},isBoolean:function(t){return"boolean"===r.getType(t)},generateGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},getType:function(t){return null===t?String(t):"object"==typeof t||"function"==typeof t?o[t.toString()]||"object":typeof t},endsWith:function(t,e){return-1!==t.indexOf(e,t.length-e.length)},clone:function(t){var e;if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return e=new Date,e.setTime(t.getTime()),e;if(t instanceof Array){e=[];for(var n=0,o=t.length;o>n;n++)e[n]=r.clone(t[n]);return e}if(t instanceof Object){e={};for(var a in t)t.hasOwnProperty(a)&&(e[a]=r.clone(t[a]));return e}throw i.invalidType}};e.exports=r},{"./XooMLExceptions":6}],8:[function(t,e,n){"use strict";function i(t,e){var n=this;if(!t.clientInterface)throw new Error("Client parameter missing");this.clientInterface=t.clientInterface;var i=this.clientInterface.auth2.getAuthInstance().currentUser.get().getAuthResponse();return this._AUTH_HEADER={Authorization:"Bearer "+i.access_token},this._DRIVE_FILE_API="https://www.googleapis.com/drive/v2/files/",n._FOLDER_MIMETYPE="application/vnd.google-apps.folder",e(!1,n)}var o=t("./XooMLConfig"),r=t("./AssociationEditor");i.prototype.isGroupingItem=function(t,e){var n=this;$.get({url:n._DRIVE_FILE_API+t,headers:n._AUTH_HEADER}).then(function(t){e(!1,n._FOLDER_MIMETYPE===t.mimeType)}).fail(function(){e("No response from GET: "+t)})},i.prototype.createGroupingItem=function(t,e,n){var i=this;$.post({url:i._DRIVE_FILE_API,headers:i._AUTH_HEADER,body:{mimeType:i._FOLDER_MIMETYPE,title:e,parents:[t]}}).then(function(t){n(!1,t.id)}).fail(function(){n("Failed to make POST request for new grouping item. Check network requests for more deatils")})},i.prototype.createNonGroupingItem=function(t,e,n){function i(t,e){var n="-------314159265358979323846",i="\r\n--"+n+"\r\n",a="\r\n--"+n+"--",s=new FileReader;s.readAsBinaryString(t),s.onload=function(){var c=t.type||"application/octet-stream",m={title:o.xooMLFragmentFileName,mimeType:c,parents:[{kind:"drive#parentReference",id:r._parentURI}]},u=btoa(s.result),p=i+"Content-Type: application/json\r\n\r\n"+JSON.stringify(m)+i+"Content-Type: "+c+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+u+a,l=this.gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+n+'"'},body:p});l.execute(function(t){e(!1,t)},function(t){e("Could not write out File",t)})}}var r=this,a=new Blob([e],{type:"text/plain",fileName:t});return i(a,n)},i.prototype._deleteID=function(t,e){var n=this;$["delete"]({url:n._DRIVE_FILE_API+"/"+t,headers:n._AUTH_HEADER}).then(function(t){e(!1,t)}).fail(function(t){e("Failed to make DELETE request for new grouping item. Check network requests for more deatils",t)})},i.prototype.deleteGroupingItem=function(t,e){this._deleteID(t,e)},i.prototype.deleteNonGroupingItem=function(t,e){this._deleteID(t,e)},i.prototype.listItems=function(t,e){var n=this,i="'"+t+"' in parents",a=this.clientInterface.client.drive.files.list({maxResults:1e3,q:i});a.execute(function(t){if(t.error)return e("Error: Bad Response / Request");var i=t.items.filter(function(t){return t.title!==o.xooMLFragmentFileName}).map(function(t){return new r({commonData:{associatedXooMLFragment:null,associatedItem:t.id,associatedItemDriver:"GoogleItemDriver",associatedXooMLDriver:"GoogleXooMLDriver",associatedSyncDriver:"MirrorSyncDriver",isGrouping:t.mimeType===n._FOLDER_MIMETYPE,localItem:t.id,displayText:t.title,publicURL:t.alternateLink}})});e(!1,i)})},i.prototype.checkExisted=function(t,e){var n,i=this;i._dropboxClient.stat(t,function(t,o){return t?i._showDropboxError(t,e):(n=!(null!==t&&404===t.status)||null===t&&o.isRemoved,e(!1,n))})},e.exports=i},{"./AssociationEditor":1,"./XooMLConfig":5}],9:[function(t,e,n){function i(t,e){var n=this;if(!t.clientInterface)throw new Error("Missing client interface in options!");this._parentURI=t.associatedItem||"root",this.clientInterface=t.clientInterface,this.gapi=this.clientInterface,this._fragmentURI=t.fragmentURI?t.fragmentURI:null;var i=this.clientInterface.auth2.getAuthInstance().currentUser.get().getAuthResponse();return this._AUTH_HEADER={Authorization:"Bearer "+i.access_token},this._DRIVE_FILE_API="https://www.googleapis.com/drive/v2/files/",e(!1,n)}var o=t("./XooMLConfig");i.prototype._readFile=function(t){var e=this;$.ajax({url:e._DRIVE_FILE_API+e._fragmentURI,data:"alt=media",dataType:"text",headers:e._AUTH_HEADER}).then(function(e){t(!1,e)})},i.prototype._searchXooML=function(t,e){var n=this,i="title = '"+o.xooMLFragmentFileName+"' and '"+e+"' in parents",r=this.clientInterface.client.drive.files.list({maxResults:10,q:i});r.execute(function(e){var i=e.items[0];return i?(n._fragmentURI=i.id,void n._readFile(t)):t("XooML Not Found")})},i.prototype.getXooMLFragment=function(t){return this._fragmentURI?void this._readFile(t,this._fragmentURI):this._searchXooML(t,this._parentURI)},i.prototype.setXooMLFragment=function(t,e){function n(e){var n=this.gapi.client.request({path:"/upload/drive/v2/files/"+r._fragmentURI,method:"PUT",params:{uploadType:"media"},body:t});n.execute(function(){e(!1)},function(t){e(t)})}function i(t,e){var n="-------314159265358979323846",i="\r\n--"+n+"\r\n",a="\r\n--"+n+"--",s=new FileReader;s.readAsBinaryString(t),s.onload=function(){var c=t.type||"application/octet-stream",m={title:o.xooMLFragmentFileName,mimeType:c,parents:[{kind:"drive#parentReference",id:r._parentURI}]},u=btoa(s.result),p=i+"Content-Type: application/json\r\n\r\n"+JSON.stringify(m)+i+"Content-Type: "+c+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+u+a,l=r.gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+n+'"'},body:p});l.execute(function(t){r._fragmentURI=t.id,e(!1)},function(t){e("Could not write out XooML Fragment",t)})}}var r=this,a="text/xml",s=new Blob([t],{type:a,fileName:o.xooMLFragmentFileName});r._fragmentURI?n(e):i(s,e)},i.prototype.checkExists=function(t){var e=this;if(this._fragmentURI)$.get({url:this._DRIVE_FILE_API+e._fragmentURI,headers:this._AUTH_HEADER}).then(function(){t(!1)}).fail(function(){t("XooML file: "+e._fragmentURI+" not found")});else{var n="title = '"+o.xooMLFragmentFileName+"' and '"+e._parentURI+"' in parents",i=this.clientInterface.client.drive.files.list({maxResults:1,q:n});i.execute(function(n){t(n.items[0]?!1:"XooML file not found in directory: "+e._parentURI)})}},e.exports=i},{"./XooMLConfig":5}]},{},[3]);
//# sourceMappingURL=item-mirror.js.map

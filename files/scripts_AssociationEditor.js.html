<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scripts/AssociationEditor.js - ItemMirror</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="ItemMirror"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.8.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AssociationEditor.html">AssociationEditor</a></li>
            
                <li><a href="../classes/FragmentEditor.html">FragmentEditor</a></li>
            
                <li><a href="../classes/ItemDriver.html">ItemDriver</a></li>
            
                <li><a href="../classes/ItemMirror.html">ItemMirror</a></li>
            
                <li><a href="../classes/PathDriver.html">PathDriver</a></li>
            
                <li><a href="../classes/SyncDriver.html">SyncDriver</a></li>
            
                <li><a href="../classes/XooMLConfig.html">XooMLConfig</a></li>
            
                <li><a href="../classes/XooMLDriver.html">XooMLDriver</a></li>
            
                <li><a href="../classes/XooMLExceptions.html">XooMLExceptions</a></li>
            
                <li><a href="../classes/XooMLUtil.html">XooMLUtil</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scripts/AssociationEditor.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * AssociationEditor is a minimal interface to represent a XooML2
 * association. This object is used together with FragmentEditor to
 * fully reprsent a XooML fragment as javascript object. It can be
 * converted seamlessly between an object and XML.
 *
 * Note that upon construction, this doesn&#x27;t actually create an
 * association, merely a /representation/ of an association.
 *
 * There are two ways to construct an AssociationEditor:
 * 1. Through a valid Association XML Element
 * 2. By specifying all data through an object
 *
 * For ItemMirror core developers only. Enable protected to see.
 *
 * @class AssociationEditor
 * @constructor
 *
 * @param {Object} options The options specified for the constructor
 *  @param {Element} options.element A DOM element that correctly
 *  represents an association as specified by the XooML schema.
 *  @param {Object} options.commonData An object that specifies the
 *  data for an association. Look at the private constructor
 *  &#x60;_fromOptions&#x60; for more details
 *
 * @protected
 */
define([
  &quot;./XooMLExceptions&quot;,
  &quot;./XooMLUtil&quot;
], function(XooMLExceptions, XooMLUtil) {
  &quot;use strict&quot;;

 var _ELEMENT_NAME = &quot;association&quot;,
     _NAMESPACE_ELEMENT_NAME = &quot;associationNamespaceElement&quot;,
     _ID_ATTR = &quot;ID&quot;,
     _DISPLAY_TEXT_ATTR = &quot;displayText&quot;,
     _ASSOCIATED_XOOML_FRAGMENT_ATTR = &quot;associatedXooMLFragment&quot;,
     _ASSOCIATED_XOOML_DRIVER_ATTR = &quot;associatedXooMLDriver&quot;,
     _ASSOCIATED_SYNC_DRIVER_ATTR = &quot;associatedSyncDriver&quot;,
     _ASSOCIATED_ITEM_DRIVER_ATTR = &quot;associatedItemDriver&quot;,
     _ASSOCIATED_ITEM_ATTR = &quot;associatedItem&quot;,
     _LOCAL_ITEM_ATTR = &quot;localItem&quot;,
     _IS_GROUPING_ATTR = &quot;isGrouping&quot;;

  function AssociationEditor(options) {
    var self = this;

    if (options.element) {
      _fromElement(options.element, self);
    } else if (options.commonData) {
      _fromOptions(options.commonData, self);
    } else {
      console.log(XooMLExceptions.missingParameter);
    }
  }

  /**
   * Converts the object into an association element, which can then
   * be converted to a string or added to the DOM.
   *
   * @method toElement
   *
   * @returns {Element} A DOM element that can be further manipulated
   * with DOM methods
   *
   * @protected
   */
  AssociationEditor.prototype.toElement = function() {
    var self = this,
        // The We use a null namespace to leave it blank, otherwise it
        // sets it as XHTML and won&#x27;t serialize attribute names properly.
        // The namespace will be inherited by the fragment it resides in.
        associationElem = document.createElementNS(null, _ELEMENT_NAME);

    // common data
    Object.keys(self.commonData).forEach( function(key) {
      if ( self.commonData[key] ) {// Don&#x27;t set null attributes
        associationElem.setAttribute(key, self.commonData[key]);
      }
    });

    // namespace data
    Object.keys(self.namespace).forEach( function(uri) {
      var nsElem = document.createElementNS(uri, _NAMESPACE_ELEMENT_NAME);
      // Attributes
      Object.keys(self.namespace[uri].attributes).forEach( function(attrName) {
        nsElem.setAttributeNS(uri, attrName, self.namespace[ uri ].attributes[ attrName ]);
      });
      // Data
      nsElem.textContent = self.namespace[ uri ].data;

      associationElem.appendChild(nsElem);
    });

    return associationElem;
  };

  /**
   * Takes an association element in XML and then converts that into
   * an AssociationEditor object. Intended to be one of the ways the
   * object is constructed
   *
   * @method _fromElement
   *
   * @param {Element} element The XML element that represents an association.
   */
  function _fromElement(element, self) {
    var dataElems, i, uri, elem;
    // Sets all common data attributes
    self.commonData = {
      ID: element.getAttribute(_ID_ATTR),
      displayText: element.getAttribute(_DISPLAY_TEXT_ATTR),
      associatedXooMLFragment: element.getAttribute(_ASSOCIATED_XOOML_FRAGMENT_ATTR),
      associatedXooMLDriver: element.getAttribute(_ASSOCIATED_XOOML_DRIVER_ATTR),
      associatedSyncDriver: element.getAttribute(_ASSOCIATED_SYNC_DRIVER_ATTR),
      associatedItemDriver: element.getAttribute(_ASSOCIATED_ITEM_DRIVER_ATTR),
      associatedItem: element.getAttribute(_ASSOCIATED_ITEM_ATTR),
      localItem: element.getAttribute(_LOCAL_ITEM_ATTR),
      // We use JSON.parse to get the value as a boolean, not as a string
      isGrouping: JSON.parse(element.getAttribute(_IS_GROUPING_ATTR))
    };

    self.namespace = {};

    dataElems = element.getElementsByTagName(_NAMESPACE_ELEMENT_NAME);
    for (i = 0; i &lt; dataElems.length; i += 1) {
      elem = dataElems[i];
      uri = elem.namespaceURI;

      /**
       * The information for a given namespace. Includes both the
       * data, and the attributes. Namespaces URIs must be unique or
       * they will overwrite data from another namespace
       * @property namespace.URI
       * @type Object
       */
      self.namespace[ uri ] = {};
      self.namespace[ uri ].attributes = {};

      for (i = 0; i &lt; elem.attributes.length; i += 1) {
        // We have to filter out the special namespace attribute We
        // let the namespace methods handle the namespace, and we
        // don&#x27;t deal with it
        if (elem.attributes[i].name !== &quot;xmlns&quot;) {
          /**
           * The attributes of the current namespace, with each attribute
           * having a corresponding value.
           * @property namespace.URI.attributes
           * @type Object
           */
          self.namespace[ uri ].attributes[ elem.attributes[i].localName ] =
            elem.getAttributeNS(uri, elem.attributes[i].localName );
        }
      }

    /**
     * This is the namespace data stored within the namespace
     * element. Anything can be put here, and it will be stored as a
     * string. ItemMirror will not do anything with the data here and
     * doesn&#x27;t interact with it at all. It is the responsibility of
     * other applications to properly store information here.
     * @property namespace.URI.data
     * @type String
     */
      self.namespace[ uri ].data = elem.textContent;
    }
  }

  /**
   * Constructs an association with data from an object
   * @method _fromOptions
   *
   * @param {Object} commonData Common data that is used by the
   * itemMirror library, and is app agnostic
   *  @param {String} commonData.displayText Display text for the
   *  association
   *  @param {String} commonData.associatedXooMLFragment URI of the
   *  associated XooML fragment for the association
   *  @param {String} commonData.associatedItem URI of the associated item
   *  @param {String} commonData.associatedXooMLDriver The associated
   *  XooML driver for the association
   *  @param {String} commonData.associatedItemDriver The associated
   *  item driver for the association
   *  @param {String} commonData.associatedSyncDriver The associated
   *  sync driver of the association
   *  @param {String} commonData.localItem The name/id of the
   *  association
   *  @param {Boolean} comnmonData.isGrouping Whether or not the
   *  association is a grouping item
   *  @param {String} commonData.readOnlyURLtoXooMLfragment Used in
   *  cases where the owner wishes for the XooML fragment representing
   *  an item to be public
   * @protected
   * @private
   */
  function _fromOptions(commonData, self) {
    if (!commonData) {
      throw XooMLExceptions.nullArgument;
    }

    // Properties from the common data
    /**
     * Common Data of the association that is accessible to all applications
     * @property commonData
     * @type Object
     */
    self.commonData = {
      /**
       * Text that describes the association
       * @property commonData.displayText
       * @type String
       */
      displayText: commonData.displayText || null,

      /**
       * The associated XooML fragment of the association
       * @property commonData.associatedXooMLFragment
       * @type String
       */
      associatedXooMLFragment: commonData.associatedXooMLFragment || null,

      /**
       * The associated XooML driver of the association
       * @property commonData.associatedXooMLDriver
       * @type String
       */
      associatedXooMLDriver: commonData.associatedXooMLDriver || null,

      /**
       * The associated sync driver of the association
       * @property commonData.associatedSyncDriver
       * @type String
       */
      associatedSyncDriver: commonData.associatedSyncDriver || null,

      /**
       * The associated item driver of the association
       * @property commonData.associatedItemDriver
       * @type String
       */
      associatedItemDriver: commonData.associatedItemDriver || null,

      /**
       * The associated item of the association
       * @property commonData.associatedItem
       * @type String
       */
      associatedItem: commonData.associatedItem || null,

      /**
       * The local item of the association
       * @property commonData.localItem
       * @type String
       */
      localItem: commonData.localItem || null,

      /**
       * Whether or not the item is a grouping item
       * @property commonData.isGrouping
       * @type Boolean
       */
      isGrouping: commonData.isGrouping || false,

      /**
       * The GUID of the association
       * @property commonData.ID
       * @type String
       */
      // GUID is generated upon construction
      ID: XooMLUtil.generateGUID()
    };

    /**
     * Data for the namespaces. Stored as a key pair value, with each
     * namespace referencing the namespace association element for the
     * corresponding namespace.
     *
     * @property namespace
     * @type Object
     */
    self.namespace = {};
    /**
     * The attributes of the current namespace, with each attribute
     * having a corresponding value.
     * @property namespace.URI.attributes
     * @type Object
     */

    /**
     * This is the namespace data stored within the namespace
     * element. Anything can be put here, and it will be stored as a
     * string. ItemMirror will not do anything with the data here and
     * doesn&#x27;t interact with it at all. It is the responsibility of
     * other applications to properly store information here.
     *
     * @property namespace.URI.data
     * @type String
     */
  }

  return AssociationEditor;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
